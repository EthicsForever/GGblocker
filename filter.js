//List by f57fea14 
var defaultURLS =[];
defaultURLS.push("*://*.kotaku.com/*");
defaultURLS.push("*://*.kotaku.co.uk/*");
defaultURLS.push("*://*.kotaku.com.au/*");
defaultURLS.push("*://*.kotaku.com.br/*");
defaultURLS.push("*://*.kotaku.jp/*");
defaultURLS.push("*://*.polygon.com/*");
defaultURLS.push("*://*.destructoid.com/*");
defaultURLS.push("*://*.rockpapershotgun.com/*");
defaultURLS.push("*://motherboard.vice.com/*");
defaultURLS.push("*://*.ign.com/*");
defaultURLS.push("*://uk.ign.com/*");
defaultURLS.push("*://au.ign.com/*");
defaultURLS.push("*://ap.ign.com/*");
defaultURLS.push("*://world.ign.com/*");
defaultURLS.push("*://*.gamespot.com/*");
defaultURLS.push("*://*.gamespot.com.au/*");
defaultURLS.push("*://*.gamespotasia.com/*");
defaultURLS.push("*://*.gamasutra.com/*");
defaultURLS.push("*://*.gameranx.com/*");
defaultURLS.push("*://*.pcgamer.com/*");
defaultURLS.push("*://*.oxmonline.com/*");
defaultURLS.push("*://*.totalxbox.com/*");
defaultURLS.push("*://games.on.net/*");
defaultURLS.push("*://*.ausgamers.com/*");
defaultURLS.push("*://*.gameplanet.co.nz/*");
defaultURLS.push("*://borderhouseblog.com/*");
defaultURLS.push("*://*.gamegatenews.com/*");
//-------------------------IT News/Review/Opinion Sites-------------------------//
defaultURLS.push("*://gizmodo.com/*");
defaultURLS.push("*://*.gizmodo.co.uk/*");
defaultURLS.push("*://*.gizmodo.com.au/*");
defaultURLS.push("*://gizmodo.uol.com.br/*");
defaultURLS.push("*://*.gizmodo.jp/*");
defaultURLS.push("*://*.pcauthority.com.au/*");
defaultURLS.push("*://*.arstechnica.com/*");
//------------------Geek/Pop Culture News/Review/Opinion Sites------------------//
defaultURLS.push("*://*.vice.com/*");
defaultURLS.push("*://*.dailydot.com/*");
defaultURLS.push("*://*.badassdigest.com/*");
defaultURLS.push("*://*.thedailybeast.com/*");
defaultURLS.push("*://*.newmediarockstars.com/*");
defaultURLS.push("*://*.rawstory.com/*");
defaultURLS.push("*://*.geekparty.com/*");
defaultURLS.push("*://*.themarysue.com/*");
defaultURLS.push("*://*.salon.com/*");
defaultURLS.push("*://*.buzzfeed.com/*");
defaultURLS.push("*://*.uproxx.com/*");
defaultURLS.push("*://*.comicsalliance.com/*");
defaultURLS.push("*://*.pastemagazine.com/*");
defaultURLS.push("*://*.wired.com/*");
defaultURLS.push("*://*.newyorker.com/*");
defaultURLS.push("*://*.cracked.com/*");
defaultURLS.push("*://*.mic.com/*");
defaultURLS.push("*://*.xojane.com/*");
defaultURLS.push("*://*.theverge.com/*");
//--------------------------Art/Design/Webcomics Sites--------------------------//
defaultURLS.push("*://*.syacartoonist.com/*");
defaultURLS.push("*://*.andysartworks.com/*");
defaultURLS.push("*://tompreston.deviantart.com/*");
//-------------------------Other Special Interest Sites-------------------------//
defaultURLS.push("*://*.gawker.com/*");
defaultURLS.push("*://valleywag.gawker.com/*");
defaultURLS.push("*://defamer.gawker.com/*");
defaultURLS.push("*://*.lifehacker.com/*");
defaultURLS.push("*://*.lifehacker.co.uk/*");
defaultURLS.push("*://*.lifehacker.com.au/*");
defaultURLS.push("*://*.lifehacker.jp/*");
defaultURLS.push("*://*.deadspin.com/*");
defaultURLS.push("*://screamer.deadspin.com/*");
defaultURLS.push("*://theconcourse.deadspin.com/*");
defaultURLS.push("*://*.io9.com/*");
defaultURLS.push("*://sploid.gizmodo.com/*");
defaultURLS.push("*://*.jalopnik.com/*");
defaultURLS.push("*://truckyeah.jalopnik.com/*");
defaultURLS.push("*://*.cink.hu/*");
defaultURLS.push("*://*.doctornerdlove.com/*");
defaultURLS.push("*://*.rationalwiki.org/*");
defaultURLS.push("*://*.tvtropes.org/*");
//-----------------------------Forum/Community Sites----------------------------//
defaultURLS.push("*://*.neogaf.com/*");
defaultURLS.push("*://*.somethingawful.com/*");
defaultURLS.push("*://*.rllmukforum.com/*");
//----------------------------------Podcasters----------------------------------//
defaultURLS.push("*://*.idlethumbs.net/idlethumbs");
defaultURLS.push("*://itunes.apple.com/podcast/idle-thumbs");
//-----------------------Video Game Developers/Publishers-----------------------//
defaultURLS.push("*://*.loveshackentertainment.com/*");
defaultURLS.push("*://*.polytroncorporation.com/*");
defaultURLS.push("*://*.fullbright.company/*");
defaultURLS.push("*://*.fullbrig.ht/*");
defaultURLS.push("*://blog.fullbrig.ht/*");
defaultURLS.push("*://*.auntiepixelante.com/*");
//----------------------------PR/Ad/Creative Agencies---------------------------//
defaultURLS.push("*://*.silverstringmedia.com/*");
defaultURLS.push("*://*.agencyforgames.com/*");
//---------------------------------Causes/Events--------------------------------//
defaultURLS.push("*://*.rebelgamejam.com/*");
defaultURLS.push("*://*.paxsite.com/*");
defaultURLS.push("*://prime.paxsite.com/*");
defaultURLS.push("*://east.paxsite.com/*");
defaultURLS.push("*://south.paxsite.com/*");
defaultURLS.push("*://aus.paxsite.com/*");
defaultURLS.push("*://auspanels.paxsite.com/*");
defaultURLS.push("*://dev.paxsite.com/*");
defaultURLS.push("*://devpanels.paxsite.com/*");
defaultURLS.push("*://*.childsplaycharity.org/*");
defaultURLS.push("*://*.igf.com/*");
defaultURLS.push("*://*.indiecade.com/*");
defaultURLS.push("*://*.feministfrequency.com/*");
defaultURLS.push("*://*.critical-proximity.com/*");
defaultURLS.push("*://*.xoxofest.com/*");
defaultURLS.push("*://*.digra.org/*");
defaultURLS.push("*://digra2014.eae.utah.edu/*");
defaultURLS.push("*://*.nordic-digra.org/*");
defaultURLS.push("*://digrafinland.wordpress.com/*");
defaultURLS.push("*://*.digraa.org/*");
defaultURLS.push("*://*.digrajapan.org/*");
defaultURLS.push("*://*.digra-j.net/*");
defaultURLS.push("*://*.digrastudents.org/*");
defaultURLS.push("*://*.todigra.org/*");

var URLStorage;
var activeFilter =null;
var disabled =false;
var disableTimerCall =null;

window.onload = function(){init()};
function init()
{
    syncGet("customFilter", function(data){
	data.trim();
	if(data.length===0)
	{
		console.log("Storage found, but no filters, adding default");
		setupInitialFilter();
	}
	else
	{
		data = JSON.parse(data);
		console.log("Loading custom filter list: "+data.length);
		console.log(data);
		console.log(chrome.runtime.lastError);
		refreshActiveFilter(data);
	}
	chrome.webRequest.onBeforeRequest.addListener(interceptRequest, {urls: activeFilter}, ['blocking']);
  });
}

function setupInitialFilter()
{
	var filter = Array();
	for(var i =0;i<defaultURLS.length;i++)
	{
	  filter.push(
		{
			"u" : defaultURLS[i],
			"a" : true
		}
	  );
	}
	syncSet("customFilter",filter, function(){
		if(typeof chrome.runtime.lastError != "undefined")
		{
			console.log(chrome.runtime.lastError);
			console.log("Could not save initial filter configuration.");
		}
	});
	activeFilter = defaultURLS;
}
function refreshActiveFilter(data)
{
	activeFilter = Array();
	for(var i =0; i < data.length;i++)
	{
		var f = data[i];
		if(f.a === true)
		{
			activeFilter.push(f.u);
		}
	}
	chrome.webRequest.onBeforeRequest.removeListener(interceptRequest);
	chrome.webRequest.onBeforeRequest.addListener(interceptRequest, {urls: activeFilter}, ['blocking']);
	chrome.webRequest.handlerBehaviorChanged();
}
function checkArchive(request)
{
  console.log("Archive Today Loaded:"+request.url);
  var codez ="var frame = document.getElementById('solid');"
		  +"if(frame ==null){"
		  +"archiveMissing();"
		  +"}else{}"
		  +"function archiveFound(){"
		  +"}"
		  +"function archiveMissing(){"
		  +" var content = document.getElementById('content');"
		  +"   if(content != null)"
		  +" 	  {"
		  +"       content.innerHTML += '<br><a href=\\'javascript:void(open(\"https://archive.today/?run=1&url=\"+encodeURIComponent(\""+chrome.extension.getBackgroundPage().URLStorage+"\")))\\'><img src=\\'https://cdn.mediacru.sh/ykmg0Yb4GSTq.png\\'></img><br>Add Page To Archive!</a>';"
		  +"}	  }";
		  console.log(codez);
  chrome.tabs.executeScript(null,
  {
	code:codez
   });
  chrome.webRequest.onCompleted.removeListener(checkArchive);
}
function interceptRequest(request)
{
  if(request && request.url && !disabled)
  {
    if(request.type == "main_frame") // new page/site is loading in main window
    {
		URLStorage = request.url;
		var d = new Date();
		var currentYear =d.getFullYear();
		var currentMonth = d.getMonth()+1;
		currentMonth = currentMonth < 10 ? "0"+currentMonth : currentMonth;
		var day = d.getDate();
		day = day < 10 ? "0"+day : day
		var hour = d.getHours();
		hour = hour < 10 ? "0"+hour : hour;
		chrome.webRequest.onCompleted.addListener(checkArchive,{urls: ['*://archive.today/*']});
        var tR={redirectUrl: "https://archive.today/" + currentYear + "."+currentMonth+"."+day + "-"+hour+"/" + request.url};
		console.log(tR);
		return tR;
    }
  }
}
function disableFive()
{
	disabled =true;
	console.log(disabled);
	//disableTimerCall=setTimeout(enableFilter, 1000*60*5);
	
}
function enableFilter()
{
	disabled =false;
	console.log(disabled);
	//clearTimeout(disableTimerCall);
	//chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {
	//  chrome.tabs.sendMessage(tabs[0].id, {greeting: "hello"}, null);
	//});
}



